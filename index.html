<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Ninja Town RPG</title>
<style>
  html,body{
    margin:0;width:100%;height:100%;overflow:hidden;background:#0f0f12;
    font-family:system-ui,-apple-system,Segoe UI,Roboto;
    touch-action:manipulation;-webkit-user-select:none;user-select:none
  }
  :root{
    --pad-top: env(safe-area-inset-top);
    --pad-right: env(safe-area-inset-right);
    --pad-bottom: env(safe-area-inset-bottom);
    --pad-left: env(safe-area-inset-left);
    --wood1:#a56a3c; --wood2:#7a4b2a; --ink:#22140b; --accent:#ff7a18;
  }
  *{-webkit-tap-highlight-color:transparent}
  .hidden{display:none!important}

  /* ===== Top bar ===== */
  #topbar{
    position:absolute; z-index:50;
    left:calc(10px + var(--pad-left));
    right:calc(10px + var(--pad-right));
    top:calc(10px + var(--pad-top));
    display:flex;gap:10px;align-items:center;justify-content:space-between;
    background:linear-gradient(var(--wood1),var(--wood2));
    border:2px solid rgba(0,0,0,.18);
    border-radius:14px;padding:10px 12px;
    box-shadow:0 10px 24px rgba(0,0,0,.25);
    color:var(--ink);
  }
  .barL,.barR{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .chip{
    display:flex;gap:8px;align-items:center;
    background:rgba(255,255,255,.25);
    border:1px solid rgba(0,0,0,.14);
    border-radius:999px;padding:6px 10px;font-weight:950;font-size:12px;
  }
  .chip b{font-family:ui-monospace,Menlo,monospace}
  .btn{
    border:0;border-radius:12px;padding:10px 12px;font-weight:950;
    background:#eee;color:#111; box-shadow:0 6px 14px rgba(0,0,0,.18);
  }
  .btn.ghost{background:rgba(255,255,255,.25); border:1px solid rgba(0,0,0,.14);}
  .btn.small{padding:8px 10px;font-size:12px;border-radius:11px}
  .btn.primary{background:var(--accent)}
  .btn:disabled{opacity:.55}

  /* ===== Town screen ===== */
  #town{
    position:absolute; inset:0;
    padding-top:calc(64px + var(--pad-top));
  }
  #townBg{
    position:absolute; inset:0;
    background-image:url("town.jpg");
    background-size:cover;
    background-position:center;
    background-repeat:no-repeat;
    filter:saturate(1.02) contrast(1.01);
  }

  /* Tap zones:
     - INVISIBLE by default (no rectangles)
     - still clickable on iPhone
  */
  .hotspot{
    position:absolute;
    background:transparent;
    border:0;
    border-radius:16px;
    padding:0;
    z-index:10;
  }

  /* Optional DEBUG mode (turn on in JS: DEBUG_HOTSPOTS=true) */
  .hotspot.debug{
    background:rgba(255,255,255,.10);
    outline:2px solid rgba(255,255,255,.25);
    backdrop-filter:blur(2px);
  }

  /* Tuned to match your screenshot positions */
  #hsDaimyo   {left: 6%; top: 18%; width:24%; height:18%}
  #hsHospital {left:34%; top: 26%; width:22%; height:18%}
  #hsRelic    {left:52%; top: 20%; width:26%; height:18%}
  #hsWeapon   {left:70%; top: 34%; width:26%; height:18%}
  #hsRecruit  {left:12%; top: 54%; width:30%; height:20%}
  #hsDojo     {left:42%; top: 62%; width:24%; height:18%}
  #hsFight    {left:70%; top: 76%; width:26%; height:20%}

  /* ===== Modal ===== */
  .modal{
    position:absolute; inset:0; z-index:80;
    display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,.35);
    padding:14px;
  }
  .card{
    width:min(680px,96%);
    background:linear-gradient(#f7edd6,#f0e0bf);
    border:2px solid rgba(0,0,0,.18);
    border-radius:18px;
    padding:14px;
    box-shadow:0 20px 50px rgba(0,0,0,.28);
    color:#23140b;
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .sp{justify-content:space-between}
  .title{margin:0;font-size:16px;font-weight:1000}
  .muted{opacity:.78;font-size:12px;line-height:1.25}
  .statGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
  .stat{
    background:rgba(255,255,255,.35);
    border:1px solid rgba(0,0,0,.12);
    border-radius:14px;
    padding:10px 12px;
    font-size:12px;
  }
  .stat b{font-family:ui-monospace,Menlo,monospace;font-size:13px}
  .list{
    margin-top:10px;
    max-height:320px; overflow:auto;
    border-radius:14px;
    border:1px solid rgba(0,0,0,.14);
    background:rgba(255,255,255,.22);
  }
  .item{
    display:flex;align-items:center;justify-content:space-between;gap:10px;
    padding:10px 12px;border-bottom:1px solid rgba(0,0,0,.10);
    font-size:12px;
  }
  .item:last-child{border-bottom:0}
  .pill{
    display:inline-block;padding:4px 8px;border-radius:999px;
    background:rgba(255,255,255,.55);
    border:1px solid rgba(0,0,0,.10);
    font-size:11px;font-weight:950;
  }

  /* ===== Battle (kept simple; uses battle.jpg if you have it) ===== */
  #battle{ position:absolute; inset:0; z-index:60; }
  #battleBg{
    position:absolute; inset:0;
    background-image:url("battle.jpg");
    background-size:cover;background-position:center;background-repeat:no-repeat;
    transform:scale(1.02);
  }
  #battleCanvas{position:absolute; inset:0; width:100%; height:100%}
  #battleTop{
    position:absolute; z-index:70;
    left:calc(10px + var(--pad-left));
    right:calc(10px + var(--pad-right));
    top:calc(10px + var(--pad-top));
    display:flex;gap:10px;align-items:center;justify-content:space-between;
  }
  .hpBox{
    flex:1 1 0;
    background:linear-gradient(var(--wood1),var(--wood2));
    border:2px solid rgba(0,0,0,.18);
    border-radius:14px;
    padding:10px 12px;
    box-shadow:0 10px 24px rgba(0,0,0,.22);
    color:var(--ink);
    min-width:0;
  }
  .hpName{font-weight:1000;font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .hpBar{height:12px;border-radius:999px;background:rgba(0,0,0,.18);overflow:hidden;margin-top:6px;border:1px solid rgba(0,0,0,.12);}
  .hpFill{height:100%; width:100%; background:linear-gradient(#ffb845,#ff7a18);}
  .vs{font-weight:1000;font-size:22px;color:#fff;text-shadow:0 4px 10px rgba(0,0,0,.35);padding:0 10px}
  #skipBtn{
    position:absolute; z-index:70;
    top:calc(78px + var(--pad-top));
    left:50%; transform:translateX(-50%);
    background:rgba(255,255,255,.75);
    border:2px solid rgba(0,0,0,.18);
    border-radius:12px; padding:10px 14px; font-weight:1000;
  }
</style>
</head>
<body>

<div id="topbar">
  <div class="barL">
    <div class="chip">HP <b id="uiHP">â€”</b></div>
    <div class="chip">â˜¯ <b id="uiKarma">0</b></div>
    <div class="chip">ðŸª™ <b id="uiGold">0</b></div>
    <div class="chip">Belt <b id="uiBelt">White</b></div>
    <div class="chip">Tier <b id="uiTier">1</b></div>
  </div>
  <div class="barR">
    <button class="btn ghost small" id="saveBtn">Save</button>
    <button class="btn ghost small" id="resetBtn">Reset</button>
  </div>
</div>

<!-- Town -->
<div id="town">
  <div id="townBg"></div>

  <!-- Invisible, building-aligned tap zones -->
  <button class="hotspot" id="hsDaimyo"   aria-label="Daimyo"></button>
  <button class="hotspot" id="hsHospital" aria-label="Hospital"></button>
  <button class="hotspot" id="hsRelic"    aria-label="Relic Shop"></button>
  <button class="hotspot" id="hsWeapon"   aria-label="Weapon Shop"></button>
  <button class="hotspot" id="hsRecruit"  aria-label="Recruit"></button>
  <button class="hotspot" id="hsDojo"     aria-label="Dojo"></button>
  <button class="hotspot" id="hsFight"    aria-label="Fight"></button>
</div>

<!-- Battle -->
<div id="battle" class="hidden">
  <div id="battleBg"></div>
  <canvas id="battleCanvas"></canvas>

  <div id="battleTop">
    <div class="hpBox">
      <div class="hpName" id="pName">You</div>
      <div class="hpBar"><div class="hpFill" id="pHPFill"></div></div>
    </div>
    <div class="vs">VS</div>
    <div class="hpBox">
      <div class="hpName" id="eName">Enemy</div>
      <div class="hpBar"><div class="hpFill" id="eHPFill"></div></div>
    </div>
  </div>

  <button id="skipBtn" class="btn">SKIP</button>
</div>

<!-- Modals (minimal hooks; keep your existing content if you want) -->
<div class="modal hidden" id="simpleModal">
  <div class="card">
    <div class="row sp">
      <h3 class="title" id="mTitle">Title</h3>
      <button class="btn ghost small" id="mClose">Close</button>
    </div>
    <div class="muted" id="mBody">Body</div>
  </div>
</div>

<script>
/* =========================
   DEBUG: set true to temporarily show tap zones
========================= */
const DEBUG_HOTSPOTS = false;
if (DEBUG_HOTSPOTS){
  document.querySelectorAll(".hotspot").forEach(h=>h.classList.add("debug"));
}

/* =========================
   Minimal game state (plug in your full logic here if you already have it)
========================= */
const SAVE_KEY="ninja_town_rpg_clean_hotspots_v1";
const BELTS=["White","Yellow","Orange","Green","Blue","Brown","Black"];
const BELT_XP=[0,50,150,350,700,1200,2000];

function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
function beltFromXP(xp){
  let idx=0;
  for(let i=0;i<BELT_XP.length;i++) if(xp>=BELT_XP[i]) idx=i;
  return BELTS[Math.min(idx,BELTS.length-1)];
}

function defaultSave(){
  return { hp:60,maxHP:60, karma:0, gold:0, tier:1, xp:0 };
}
let save = load();
function load(){
  try{
    const raw=localStorage.getItem(SAVE_KEY);
    if(!raw) return defaultSave();
    const s=JSON.parse(raw);
    return {...defaultSave(), ...s};
  }catch{ return defaultSave(); }
}
function persist(){ localStorage.setItem(SAVE_KEY, JSON.stringify(save)); }

function refreshTop(){
  document.getElementById("uiHP").textContent = `${save.hp}/${save.maxHP}`;
  document.getElementById("uiKarma").textContent = save.karma;
  document.getElementById("uiGold").textContent = save.gold;
  document.getElementById("uiTier").textContent = save.tier;
  document.getElementById("uiBelt").textContent = beltFromXP(save.xp);
}

document.getElementById("saveBtn").onclick=()=>{ persist(); refreshTop(); };
document.getElementById("resetBtn").onclick=()=>{
  localStorage.removeItem(SAVE_KEY);
  save = defaultSave();
  persist(); refreshTop();
};

/* =========================
   Simple modal helper
========================= */
const modal = document.getElementById("simpleModal");
const mTitle = document.getElementById("mTitle");
const mBody  = document.getElementById("mBody");
document.getElementById("mClose").onclick=()=>modal.classList.add("hidden");

function showModal(title, body){
  mTitle.textContent = title;
  mBody.innerHTML = body;
  modal.classList.remove("hidden");
}

/* =========================
   TIE BUTTONS TO BUILDINGS
   (Replace showModal with your real screens if you already have them)
========================= */
document.getElementById("hsDaimyo").onclick   = ()=>showModal("Daimyo", "Belt & progress screen.");
document.getElementById("hsHospital").onclick = ()=>{
  save.hp = save.maxHP;
  persist(); refreshTop();
  showModal("Hospital", "Healed to full HP.");
};
document.getElementById("hsRelic").onclick    = ()=>showModal("Relic Shop", "Relics screen (karma purchases).");
document.getElementById("hsWeapon").onclick   = ()=>showModal("Weapon Shop", "Weapons screen (gold purchases).");
document.getElementById("hsRecruit").onclick  = ()=>showModal("Recruit", "Recruit roster (unlocks at Yellow).");
document.getElementById("hsDojo").onclick     = ()=>showModal("Dojo", "Train STR / AGI / END with TP.");
document.getElementById("hsFight").onclick    = ()=>showModal("Fight", "Start battle here (wire to your battle logic).");

/* =========================
   Battle view show/hide hooks
   (Keep your existing battle engine; this is just structure)
========================= */
const townEl = document.getElementById("town");
const battleEl = document.getElementById("battle");
function showBattle(v){
  battleEl.classList.toggle("hidden", !v);
  townEl.classList.toggle("hidden", v);
}
document.getElementById("skipBtn").onclick=()=>showBattle(false);

/* init */
persist();
refreshTop();
</script>

</body>
</html>
